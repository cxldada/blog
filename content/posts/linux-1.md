---
title: "ShellScript"
date: 2024-03-12T11:30:54+08:00
draft: false
categories: 
- Linux
---

> shell脚本的本质：shell命令的有序集合  
> shell编程的基本过程：  

>1. 建立shell文件：包含任意多行操作系统命令或者shell命令的文本文件
>2. 赋予shell文件执行权限：chown修改文件所有者，chgrp修改文件所有组，chmod修改文件权限
>3. 执行shell文件：直接在命令行中调用shell程序

<!--more-->

## Shebang

出现在脚本文件的第一行，以 `#!` 开头用来指明执行本脚本文件的解释器可执行文件

如果未指定 Shebang。则会使用默认的 shell(`echo $SHELL`)

## History

**相关的参数：**

-c：清空内存中历史命令

-r：从文件中回复历史命令(`~/.bash_history`)

**相关的环境变量：**

`$HISTSIZE` ：可以存储的命令条数

`$HISTFILE`：存储历史命令的文件

**特殊用法:** 

`!历史ID`：可以直接执行历史ID 对应的命令

`!!`：调用上次指定的命令

## shell变量
> shell允许用户建立变量存储数据，单不支持数据类型，将任何赋给变量的值都解释为一串字符串。  
> 命名规则与c++相同

* **变量命与值之间不能有空格**
* **变量的定义**
  *  `name1=‘变量1’`：单引号括起来的不能识别特殊语法
  * `name2=“${name1}”`：双引号可以识别特殊语法，此例中变量 name2 的值与上一列中 name1 值相等
  * name3=`ls`：反引号是将反引号内的语句当做命令执行，并将命令执行的结果作为变量的值，类似于`$()`

* **使用变量的方式**
  * `$变量名`：返回变量的值
  * `${变量名}`：返回变量的值
  * `${#变量名}`：返回变量的长度
  * `${变量名:start}`：返回 start 开始往后的字符
  * `${变量名:start:length}`：返回 start 开始往后指定长度的字符
  * `${变量名#word}`：从变量开头删除最短匹配的 word 字符串
  * `${变量名##word}`：从变量开头删除最长匹配的 word 字符串
  * `${变量名%word}`：从变量尾部删除最短匹配的 word 字符串
  * `${变量名%%word}`：从变量尾部删除最长匹配的 word 字符串
  * `${变量名/pattern/string}`：用 string 替换第一个匹配的 pattern
  * `${变量名//pattern/string}`：用 string 替换所有的 pattern
* **特殊 shell 扩展变量**
  * 以下四个扩展变量，都属于对变量的**值**进行判断处理
  * `${var:-word}`：如果 var 变量的值为空或未定义，则返回 word 字符串；否则返回 var 变量的值
  * `${var:=word}`：如果 var 变量的值为空或未定义，将 word 字符串赋给 var ，并返回 var 的新值；否则返回 var 变量的值
  * `${var:?word}`：如果 var 变量的值为空或未定义，将 word 当做 stderr 输出 ；否则返回 var 变量的值
    * 一般用于变量为空会导致错误时，返回错误信息
  * `${var=+word}`：如果var 变量的值为空或未定义，什么都不做；否则返回 word

* **变量的作用域：**
  * **本地变量**只在当前 shell中有效
  * **环境变量**对当前 shell 以及其所有子shell
  * **局部变量**只在 shell 函数内有效
* **特殊变量：**
  * 特殊参数变量
    * `$0`：执行的脚本名
    * `$1~n`：脚本参数，大于 9 需要使用花括号括起来`${10}`
    * `$#`：获取脚本参数的个数
    * `$*`：所有的脚本参数都存在这一个变量中，不能用于循环，只是一个普通变量
    * `$@`：所有的脚本参数都存在这一个变量中，可以用于循环，是看做一个数组变量
  * 特殊状态变量
    * `$?`：上一条指令执行后的退出码，0 表示正确，非 0 表示错误
    * `$$`：获取当前 shell 脚本的进程 ID号
    * `$!`：上一次后台进城的 PID
    * `$_`：获取上一个命令执行时的最后一个参数
* 环境变量（全局变量 ）
  * 定义变量时在前面添加`export`可以将变量变成环境变量
  * 插件环境变量的命令
    * `set`：显示当前 shell 中的所有变量，包括全局变量、局部变量以及函数定义
    * `env`：只显示当前 shell 中的所有全局变量
    * `declare`：如同 set
    * `export`：显示所有导出的环境变量
  * 取消环境变量的定义`unset 变量名`
  * 设置只读变量：`readonly name=“111”`

## Bash 内置命令

### echo

* 参数：
  * `-n`：不换行输出
  * `-e`：解析字符串中的特殊符号
    * `\n`：换行
    * `\r`：回车
    * `\t`：制表符
    * `\b`：退格 

### printf

类似于 c 语言的`printf`函数

### eval

执行多个命令

### exec

不创建子进程的情况下，执行后续命令，且执行完毕后，自动 exit

### read

* 从标准输入读入一行，并赋值给后面的变量
* 格式：read var

### expr

* 算术运算命令。
* 格式：expr 计算式
* 数字和运算符之间一定要加空格

### test

* 测试三种对象：字符串、整数和文件属性
* 格式：test "$string" = "yes"测试是否为字符串
* 格式：test $num -eq 18 测试num的值是否为整数18
* 格式：test -d tmp 测试是否为一个目录名

### seq

给一个执行的数字，可以生成一个序列。比如

```bash
> seq 3
> 1
> 2
> 3
```

`-s`：可以指定分隔符。默认分隔符为换行符

### time

```bash
bash-3.2$ time for num in {1..10000};do char=`seq -s "cxldada" 100`; echo ${#char} &>/dev/null; done
real	0m12.672s  # 实际运行时间
user	0m2.634s   # 用户态执行时间
sys	0m8.511s	   # 内核态执行时间
```

#### find

`find 需要查询的路径 -name(文件名) -type(文件类型) -mtime +7(修改时间大于七天)`

## 脚本文件

* 执行脚本文件的方式
  * 通过文件命或者作为解释器参数调用：会开启一个新的子 shell 去执行脚本内容，执行后退出子 shell
  * 通过 `source` 命令调用脚本文件：在当前 shell 中执行脚本文件
* shell 初始化脚本
  * `/etc/profile`是每个 shell 启动时都会执行的脚本
  * 然后是执行个人家 目录下的`~/.bash_profile`

### shell语句
#### 循环语句

* for循环

```bash
for num in {1..100}
do
	echo $num
done
```
